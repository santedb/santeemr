<!--
 - Copyright 2021-2025 SanteSuite Contributors (See NOTICE.md for full copyright notices)
 - Portions Copyright (C) 2019 - 2021, Fyfe Software Inc. and the SanteSuite Contributors
 - Portions Copyright (C) 2015-2018 Mohawk College of Applied Arts and Technology
 -
 - Licensed under the Apache License, Version 2.0 (the "License"); you
 - may not use this file except in compliance with the License. You may
 - obtain a copy of the License at
 -
 - http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing, software
 - distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 - WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 - License for the specific language governing permissions and limitations under
 - the License.
 -->
<div xmlns="http://www.w3.org/1999/xhtml" class="d-flex flex-column justify-content-start mt-1">
    <label class="font-weight-bold mb-1">
        <i class="fas fa-fw fa-syringe"></i>
        {{ ::act.typeConceptModel | concept }}

        <!-- Has not been user added -->
        <span>: {{ ::act.participation.Product[0].playerModel.name.Assigned | name }} {{
            'ui.model.substanceAdministration.doseSequence' | i18n }}
            {{ act.doseSequence | number: 0 }}
        </span>
    </label>

    <h5 ng-if="act.isNegated" class="text-danger">
        <i class="fas fa-fw fa-exclamation-triangle"></i> {{ 'ui.model.act.isNegated' | i18n }} - {{
        act.reasonConceptModel | concept }}
        </h5>
    <div ng-if="!act.isNegated">
        <div ng-if="act.tag.isBackEntry" class="container-fluid">
            <div class="row">
                <label class="control-label col-sm-12 col-md-3">
                    {{ 'ui.model.act.actTime.date' | i18n }}
                    <hint-popover hint-title="ui.model.act.actTime.date" />
                </label>

                <div class="col-sm-12 col-md-8">
                    <div class="input-group">
                        <input readonly="readonly" disabled="disabled" ng-model="act.actTime" type="date" />

                        <div class="input-group-append">
                            <span class="input-group-text">
                                <strong class="mr-1">{{ 'ui.model.act.relationship.Fulfills.target.actTime' | i18n }}
                                </strong>

                                {{ ::act.tag.$originalDate[0] || act.relationship.Fulfills[0].targetModel.startTime ||
                                act.startTime | humanDate: 'D' }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div ng-if="!act.tag.isBackEntry" class="container-fluid">
            <div class="row  form-group">
                <label class="control-label col-sm-12 col-md-4 required">
                    {{ 'ui.model.substanceAdministration.Consumable.lotNumber' | i18n }}
                </label>

                <div class="col-sm-12 col-md-7">
                    <entity-select readonly="readonly" disabled="disabled" class="form-control"
                        ng-model="act.participation.Consumable[0].player" entity-type="'ManufacturedMaterial'" filter="{
                        'determinerConcept' : 'F29F08DE-78A7-4A5E-AEAF-7B545BA19A09',
                        'statusConcept' : 'C8064CBD-FA06-4530-B430-1A52F1530C27',
                        'relationship[HeldEntity].source.participation[Tracker].act.relationship[HasComponent].target' : $root.getParentVariable($parent, 'getEncounter')().id,
                        'relationship[Instance].source.relationship[HasGeneralization].target' : act.participation.Product[0].player
                    }" display="item.lotNumber">
                    </entity-select>
                </div>
            </div>

            <!-- Used Entities -->
            <div class="form-group row" ng-if="act.participation.Product[0].playerModel.relationship.UsedEntity">
                <label class="control-label col-sm-12 col-md-4 required mb-2"
                    ng-repeat-start="used in act.participation.Product[0].playerModel.relationship.UsedEntity track by $index">
                    {{ used.targetModel.name | name: 'Assigned' }}
                </label>

                <div ng-repeat-end="" class="col-sm-12 col-md-7 mb-2">
                    <entity-select readonly="readonly" disabled="disabled" class="form-control"
                        ng-model="act.participation.Consumable[$index + 1].player" auto-select-singles="true"
                        entity-type="'ManufacturedMaterial'" filter="{
                        'determinerConcept' : 'F29F08DE-78A7-4A5E-AEAF-7B545BA19A09',
                        'statusConcept' : 'C8064CBD-FA06-4530-B430-1A52F1530C27',
                        'relationship[HeldEntity].source.participation[Tracker].act.relationship[HasComponent].target' : $root.getParentVariable($parent, 'getEncounter')().id,
                        'relationship[Instance].source.relationship[HasGeneralization].target' : used.target
                    }" display="item.lotNumber">
                    </entity-select>
                </div>
            </div>

            <!-- Administration Site -->
            <div class="form-group row">
                <label class="control-label col-sm-12 col-md-4 required">
                    {{ 'ui.model.substanceAdministration.site' | i18n }}
                </label>

                <div class="control-label col-sm-12 col-md-7">
                    <concept-select readonly="readonly" disabled="disabled" ng-model="act.site"
                        concept-set="'AdministrationSite'" class="form-control"></concept-select>
                </div>
            </div>
        </div>
    </div>
</div>