<BiViewDefinition xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" name="by-date" id="org.santedb.emr.bi.view.patient.registrationsByGender" xmlns="http://santedb.org/bi" status="active">
  <meta>
    <authors>
      <add>SanteSuite Contributors</add>
    </authors>
  </meta>
  <query ref="#org.santedb.emr.bi.query.patient.details" name="patient"></query>
  <aggregations>
    <add>
      <providers>
            <invariant>sqlite</invariant>
            <invariant>npgsql</invariant>
      </providers>
      <grouping>
        <column name="gndr">
          case 
            when pat_gndr_cd_id = '094941e9-a3db-48b5-862c-bc289bd7f86c' then 'Female' 
            when pat_gndr_cd_id = 'f4e3a6bb-612e-46b2-9f77-ff844d971198' then 'Male' 
            when pat_gndr_cd_id = '43ba2ea1-93df-4e06-8bf9-1e65c4a46a3f' then 'Unknown' 
            when pat_gndr_cd_id = '091f27e8-e592-4e81-b5d7-338b7749d8b8' then 'Other' 
            when pat_gndr_cd_id = 'ae94a782-1485-4241-9bca-5b09db2156bf' then 'Undifferentiated' 
          end
        </column>
        <column name="age">
          CAST(age_at_reg as int)
        </column>
      </grouping>
      <select>
        <column name="n_registrations" fn="count-distinct">ent_id</column>
      </select>
    </add>
  </aggregations>
</BiViewDefinition>