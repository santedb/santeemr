<div xmlns="http://www.w3.org/1999/xhtml" xmlns:sdb="http://santedb.org/applet">
    <sdb:script>~/controllers/patient/widgets/status.js</sdb:script>
    <sdb:widget order="120" name="org.santedb.emr.widget.patient.status" headerClass="alert-primary" size="Medium"
        type="Panel" context="org.santedb.emr.patient.view.dashboard">
        <sdb:icon>fas fa-rectangle-list</sdb:icon>
        <sdb:description lang="en">Patient Status</sdb:description>
        <sdb:demand>1.3.6.1.4.1.33349.3.1.5.9.2.2.3</sdb:demand>
        <sdb:guard>query("Act", { "participation[RecordTarget].player" : scopedObject.id, _count: 0,
            "typeConcept.conceptSet": "b73e6dbc-890a-11f0-8959-c764088c39f9",
            "statusConcept" : "afc33800-8225-4061-b168-bacc09cdbae3",
            "moodConcept" : "ec74541f-87c4-4327-a4b9-97f325501747" }).totalResults &gt; 0</sdb:guard>
        <sdb:views>
            <sdb:view type="Edit">
                <sdb:demand>1.3.6.1.4.1.33349.3.1.5.9.2.2.1</sdb:demand>
                <sdb:guard>!scopedObject._currentEncounter &amp;&amp; scopedObject.deceasedDate == null</sdb:guard>
            </sdb:view>
        </sdb:views>
    </sdb:widget>

    <div ng-controller="EmrPatientStatusWidgetController">
        <div ng-if="!statusObservations">
            <i class="fas fa-fw fa-circle-notch fa-spin"></i> {{ 'ui.wait' | i18n }}
        </div>
        <div ng-if="statusObservations">
            <ul ng-if="panel.view != 'Edit'" class="list-group">
                <li ng-repeat="cond in statusObservations track by $index" class="list-group-item d-flex"
                    ng-init="act = cond" ng-class="{ 'list-group-item-warning' : act.tag.$isCondition }"
                    ng-if="cond.template">
                    <i class="fas fa-fw m-1" ng-class="resolveTemplateIcon(act.templateModel.mnemonic)"></i>
                    <div class="flex-grow-1">
                        <ng-include class="d-inline" src="::resolveSummaryTemplate(act.templateModel.mnemonic)" />
                    </div>
                </li>
            </ul>
            <form ng-submit="updateStatusObservations(panel.editForm)" name="panel.editForm" novalidate="novalidate">
                <ul class="list-group" ng-init="ownerForm = panel.editForm">
                    <!-- Maintain Compatibility with the act-edit -->
                    <li ng-repeat="cond in amendmentObservations track by $index" class="list-group-item"
                        ng-init="act = cond" ng-if="cond.template">
                        <div class="emr-privacy-float">
                            <!-- Action Toolbar for the object-->
                            <div class="mx-2 btn-group">
                                <div class="btn-group dropleft" ng-if="!act.policy.length">
                                    <button class="btn btn-dark btn-sm" type="button" title="Seal Record"
                                        data-toggle="dropdown" aria-haspopup="true">
                                        <i class="mr-2 my-1 fas fa-caret-left"></i>
                                        <span class="fa-stack">
                                            <i class="fas fa-shield fa-stack-1x"></i>
                                            <i class="fas fa-plus fa-stack-1x" style="color:green"></i>
                                        </span>
                                    </button>
                                    <div class="dropdown-menu">
                                        <button class="dropdown-item" type="button" ng-click="setPolicy(act, pol)"
                                            ng-repeat="pol in availablePolicies track by $index">
                                            <i class="fas fa-fw fa-shield"></i> {{ pol.name | i18n }}
                                        </button>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-danger" type="button" ng-disabled="act.tag['$pep.masked']"
                                    ng-click="setPolicy(act, null)" title="Unseal Record" ng-if="act.policy.length">
                                    <span class="fa-stack">
                                            <i class="fas fa-shield fa-stack-1x"></i>
                                            <i class="fas fa-times fa-stack-1x" style="color:red"></i>
                                        </span>
                                </button>

                            </div>
                        </div>
                        <h5><i class="fas fa-fw" ng-class="::resolveTemplateIcon(act.templateModel.mnemonic)"></i>
                            {{ ::getTemplateName(act.templateModel.mnemonic) }}</h5>
                        <ng-include src="::resolveTemplateForm(act.templateModel.mnemonic);" />
                    </li>
                </ul>
            </form>
        </div>
    </div>
</div>