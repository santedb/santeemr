<div xmlns="http://www.w3.org/1999/xhtml" xmlns:sdb="http://santedb.org/applet" class="container-fluid">
    <sdb:script static="false">~/controllers/patient/search.js</sdb:script>
    <sdb:state name="santedb-emr.patient.search">
        <sdb:demand>1.3.6.1.4.1.33349.3.1.5.9.2.2.0</sdb:demand>
        <sdb:url>/search?{q}</sdb:url>
        <sdb:view>
            <sdb:controller>EmrPatientSearchController</sdb:controller>
            <sdb:title lang="en">Search</sdb:title>
        </sdb:view>
    </sdb:state>

    <div class="row">
        <div class="col-lg-8 col-md-12 offset-lg-2">
            <form class="form" ng-submit="search(searchForm)" name="searchForm" autocapitalize="off" autocomplete="off">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-heading">
                        {{ 'ui.emr.patient.search' | i18n }}</h5>
                    </div>
                    <div class="card-body">
                        <div class="form-group row">
                            <div class="col-10 offset-1">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <h5 class="card-title text-muted m-1 py-2"><i class="fas fa-fw fa-search"></i></h5>
                                    </div>
                                    <input required="required" type="text" ng-model="search.value"
                                        class="form-control" placeholder="{{ 'ui.emr.patient.search.placeholder' | i18n }}" 
                                        autocomplete="__away" autofocus="true"/>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" ng-click="scanSearch()">
                                            <i class="fas fa-qrcode"></i> {{ 'ui.action.scan' | i18n }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <label class="offset-1 col-10">
                                <input type="checkbox" ng-model="search.upstream"  />
                                {{ 'ui.emr.patient.search.online' | i18n }}
                            </label>
                        </div>
                        <div class="card-footer">
                            <button class="btn btn-primary float-right" id="btnSearch" type="submit"
                                ng-disabled="searchForm.$invalid">
                                <i class="fas fa-search"></i> {{ 'ui.action.search' | i18n }}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="row" ng-if="filter">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-heading">{{ 'ui.emr.patient.search.results' | i18n }}</h5>
                </div>
                <div class="card-body">
                    <entity-list 
                        type="Patient" 
                        can-filter="false" 
                        default-query="filter" 
                        actions="[ 
                            { name: 'register', demand: '1.3.6.1.4.1.33349.3.1.5.9.2.2.1', sref: 'santedb-emr.patient.register', className: 'btn-primary', icon: 'fa fa-user-plus' }
                        ]"
                        item-actions="[
                            { name: 'view', demand: '1.3.6.1.4.1.33349.3.1.5.9.2.2.1', sref: 'santedb-emr.patient.view', className: 'btn-primary', icon: 'fas fa-arrow-right' }
                        ]"
                        display="grid"
                        >
                        <div class="card-body">
                            <h5>{{ item.name | name }}</h5>
                            <div class="d-flex">
                                <span class="badge badge-primary">
                                    <i class="fas fa-fw" ng-class="{
                                        'fa-genderless' : null ,
                                        'fa-male' : item.genderConcept == 'f4e3a6bb-612e-46b2-9f77-ff844d971198',
                                        'fa-female' : item.genderConcept == '094941e9-a3db-48b5-862c-bc289bd7f86c'
                                    }"></i> {{ item.genderConceptModel | concept }}
                                </span>
                            </div>
                        </div>
                     </entity-list>
                </div>
            </div>
            
        </div>
    </div>
</div>